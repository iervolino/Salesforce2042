/*
 * Author Paul Coleman
 * Western Governors University 
 *
 * Date January 28, 2013 @ 1447 hrs
 * Revised: Person Account Refactor 
 * 
 * Revised Date Oct 30, 2012 @ 1148 hrs
 * Revised: (security audit compliance: with sharing) 
 * 
 * Tests the methods of StudentFieldExperience class via MyFieldExperienceController 
 * This class defines data setup methods for testing MyFieldExperienceController, which provides code coverage for StudentFieldExperience
 *
 */
@isTest()
public with sharing class TestStudentFieldExperience {
     
     public static void setupTestFEData() {
      if ( Test.isRunningTest() ) {
          
          TestStudentUser.setupStudentTestData();
        
          User testUser = TestStudentUser.getSAdminUser();
          System.RunAs( testUser ) {
          
                   //Setup test school and test district
                   if ( [SELECT count() from Account where  isDeleted = false AND RecordType.DeveloperName = 'SchoolK12'] == 0) {
                      String accountJson = '[{"attributes":{"type":"Account"},"Name":"Piner Elementary","County__c":null,"RecordTypeId":"01230000000c0MTAAY","IsWGUPlacementRequired__c":"false","ShippingCity":"Santa Rosa","ShippingState":"CA","SchoolDistrict__c":null},{"attributes":{"type":"Account"},"Name":"Piner-Olivet Union Elementary","County__c":"Sonoma","RecordTypeId":"01230000000bvO3AAI","IsWGUPlacementRequired__c":"false","ShippingCity":"Santa Rosa","ShippingState":"CA","SchoolDistrict__c":null}]';
                      List<Account> accounts = (List<Account>)JSON.deserialize(accountJson, List<Account>.class);              
                      insert accounts;
                      accounts[0].SchoolDistrict__c = accounts[1].id;
                      update accounts[0];         
                   }
                   
                   //Setup test Teacher License
                   if ( [select count() from TeacherLicense__c where LicenseStateCode__c = 'UT'] == 0) {
                      String licenseJson = '[{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Administration","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Early Childhood K-3","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Elementary Education K-6 or 1-8","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Elementary Mathematics K-6","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT English as a Second Language K-12","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Level 2 (Middle Grades) Mathematics","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Level 4 (Secondary) Mathematics 6-12","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Secondary Biology 6-12","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Secondary Chemistry 6-12","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Secondary Earth Science 6-12","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Secondary Physics 6-12","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT Secondary Social Studies Composite 6-12","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT SPED Mild/Moderate K-12","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null},{"attributes":{"type":"TeacherLicense__c"},"Name":"UT SPED Mild/Moderate K-12 and Elementary 1-8","UtahLicenseTitle__c":null,"LicenseStateCode__c":"UT","Active__c":true,"UtahReciprocity__c":false,"Version__c":"1","VersionChangeDate__c":null}]';
                      List<TeacherLicense__c> licenses = (List<TeacherLicense__c>)JSON.deserialize(licenseJson, List<TeacherLicense__c>.class);
                      for (TeacherLicense__c license: licenses) {
                      	 license.AvailableForDTApp__c = true;
                      }
                      insert licenses;         
                   }          
        
         
                   //Setup test Cohort
                   if ( [select count() from Cohort__c] == 0) {
                      String cohortJson = '[{"attributes": {"type": "Cohort__c"},"Name": "January 2013","CohortYear__c": "2013","CohortMonth__c": "January","AvailableForStudents__c": true},{"attributes": {"type": "Cohort__c"},"Name": "September 2013","CohortYear__c": "2013","CohortMonth__c": "September","AvailableForStudents__c": true}]';
                      List<Cohort__c> cohorts = (List<Cohort__c>)JSON.deserialize(cohortJson, List<Cohort__c>.class);
                      insert cohorts;         
                   }
                   
                   
                   //Setup test WGU FE To Do template
                   if ( [select count() from WGUFEToDo__c] == 0 ) {
                     String wgufetodoJson = '[{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":12,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":null,"isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"PCE/DT: School Preference","SortOrder__c":110,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":11},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":2,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":null,"isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"Field Experience Requirements Overview","SortOrder__c":10,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":1},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":10,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":"LiabilityInsuranceUploaded__c","isManualVerification__c":false,"isFileUpload__c":true,"isBannerDataVerificationRequired__c":false,"Name":"PCE/DT: Liability Insurance Upload","SortOrder__c":90,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":9},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":7,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":"SFAWPassed__c","isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":true,"Name":"PCE: SFAW Assessment","SortOrder__c":60,"StudentTaskCode__c":"SFAW","CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":6},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":15,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":"DTAffidavit__c","isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"DT: Affidavit","SortOrder__c":140,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":14},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":17,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":"ContentExamUploaded__c","isManualVerification__c":false,"isFileUpload__c":true,"isBannerDataVerificationRequired__c":false,"Name":"DT: Content Exams Upload","SortOrder__c":160,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":16},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":11,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":"FERPAUploaded__c","isManualVerification__c":false,"isFileUpload__c":true,"isBannerDataVerificationRequired__c":false,"Name":"PCE: FERPA Upload","SortOrder__c":100,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":10},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":8,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":"BasicSkillsPassed__c","FECheckboxFieldName__c":"BasicSkillsPassed__c","isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":true,"Name":"PCE: Basic Skills Exams","SortOrder__c":70,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":7},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":16,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":"DTCohortTimelineUploaded__c","isManualVerification__c":false,"isFileUpload__c":true,"isBannerDataVerificationRequired__c":false,"Name":"DT: Cohort Timeline Upload","SortOrder__c":150,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":15},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":3,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":null,"isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"Personal Information Verification","SortOrder__c":20,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":2},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":1,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":"PCETaskListUploaded__c","isManualVerification__c":false,"isFileUpload__c":true,"isBannerDataVerificationRequired__c":false,"Name":"PCE: Signed Task Summary Upload","SortOrder__c":200,"StudentTaskCode__c":null,"CompletionCriteria__c":null,"TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":19},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":14,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":"FieldExperiences__c.CohortMonth__c FieldExperiences__c.CohortYear__c","FECheckboxFieldName__c":null,"isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"DT: Cohort","SortOrder__c":130,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":13},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":4,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":"CodeofEthicsAcknowledgment__c","FECheckboxFieldName__c":"CodeofEthicsAcknowledgment__c","isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"Teacher\'s College Code of Professional Behavior and Dispositions","SortOrder__c":30,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":3},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":18,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":"multiple fields...","FECheckboxFieldName__c":null,"isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"DT: Additional Placement Information","SortOrder__c":170,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":17},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":9,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":"BackgroundClearedforPCE__c","isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"PCE: Background Clearance","SortOrder__c":80,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":8},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":5,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":"State__c","FECheckboxFieldName__c":null,"isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"PCE/DT: State Intended for Licensing","SortOrder__c":40,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":4},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":13,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":"PCEVerificationFormUploaded__c","isManualVerification__c":false,"isFileUpload__c":true,"isBannerDataVerificationRequired__c":false,"Name":"PCE: Verification Form Upload","SortOrder__c":120,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":12},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":6,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":"FieldExprience__c.TeacherLicense__c","FECheckboxFieldName__c":null,"isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"PCE/DT: License Name for Certification","SortOrder__c":50,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":5},{"attributes":{"type":"WGUFEToDo__c"},"AfterCompletionMessage__c":null,"NextCardIndex__c":19,"Instructions__c":null,"CompletionURL__c":null,"FEFieldName__c":null,"FECheckboxFieldName__c":"BackgroundClearedforDT__c","isManualVerification__c":false,"isFileUpload__c":false,"isBannerDataVerificationRequired__c":false,"Name":"DT: Background Clearance","SortOrder__c":180,"StudentTaskCode__c":null,"CompletionCriteria__c":"true","TaskDurationDays__c":null,"VisualforceComponentName__c":null,"CardIndex__c":18}]';
                     List<WGUFEToDo__c> todotemplates = (List<WGUFEToDo__c>)JSON.deserialize(wgufetodoJson, List<WGUFEToDo__c>.class);
                     insert todotemplates;
                   }
                   
                   //Setup test WGU FE To Do Programs
                   String testProgramCode = TestStudentUser.getTestStudentContact().ProgramCode__c;
                   System.assert( testProgramCode != null );
                   if ( [select count() from WGUFEToDoByProgram__c where Name = :testProgramCode] == 0 ) {
                     List<WGUFEToDoByProgram__c> todoprograms = new List<WGUFEToDoByProgram__c>();
                     for( WGUFEToDo__c todo: [select AfterCompletionMessage__c,NextCardIndex__c,Instructions__c,CompletionCriteria__c,CompletionURL__c,FEFieldName__c,Id,IsBannerDataVerificationRequired__c,Name,PrerequisiteToDo__c,SortOrder__c,StudentTaskCode__c,TaskDurationDays__c,CardIndex__c FROM WGUFEToDo__c] ) {
                        todoprograms.add( new WGUFEToDoByProgram__c(Name=testProgramCode, ProgramCode__c=testProgramCode, WGUFEToDo__c=todo.id) );
                     }
                     insert todoprograms;
                   }         
             
          } //END System.runAs 
      }
    }
    
   //REUSE the MyFieldExperienceController Tests first

}